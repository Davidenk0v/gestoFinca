---
import sendGrid from '@sendgrid/mail';
sendGrid.setApiKey( import.meta.env.SENDGRID_API_KEY );
console.log(import.meta.env.SENDGRID_API_KEY);
if (Astro.request.method === 'POST') {
  try{
    // Getting posted data from our contact form
    const data = await Astro.request.formData();
    const subject = data.get('subject');
    const name = data.get('name');
    const email = data.get('email');
    const message = data.get('message');

    // TODO: Do not forget to do validation and error handling over received data from your contact form.

    // Sending email
    const msg = {
      to: 'david4100ggx@gmail.com', // Change to your recipient
      from: 'david4100@gmail.com', // Change to your verified sender
      replyTo: {email:email, name:name},
      subject: subject,
      text: message,
    }
    console.log(msg);
    
    await sendGrid.send(msg).then(() => {
      console.log('Email sent')
    }).catch((error) => {
      console.error(error)
    });

  } catch (error) {
    console.error(error);
  }
}
---
    <form method="POST" class="max-w-sm mx-auto">
      <div>
        <label
          for="small-input"
          class="block m-2 text-sm font-medium text-gray-900 :text-white"
        >
          Nombre*
        </label>
        <input
        name="name"
          type="text"
          id="small-input"
          class="block w-full p-2 text-gray-900 border border-gray-300 rounded-lg bg-gray-50 text-xs focus:ring-green-700 focus:border-green-700 :bg-gray-700 :border-gray-600 :placeholder-gray-400 :text-white :focus:ring-green-700 :focus:border-green-700"
        />
      </div>
      <div>
        <label
          for="small-input"
          class="block m-2 text-sm font-medium text-gray-900 :text-white"
        >
          Teléfono*
        </label>
        <input
        name="phone"
          type="text"
          id="small-input"
          class="block w-full p-2 text-gray-900 border border-gray-300 rounded-lg bg-gray-50 text-xs focus:ring-green-700 focus:border-green-700 :bg-gray-700 :border-gray-600 :placeholder-gray-400 :text-white :focus:ring-green-700 :focus:border-green-700"
        />
      </div>
      <div>
        <label
          for="small-input"
          class="block m-2 text-sm font-medium text-gray-900 :text-white"
        >
          Correo electrónico*
        </label>
        <input
        name="email"
          type="email"
          id="small-input"
          class="block w-full p-2 text-gray-900 border border-gray-300 rounded-lg bg-gray-50 text-xs focus:ring-green-700 focus:border-green-700"
        />
      </div>
      <div>
        <label
          for="small-input"
          class="block m-2 text-sm font-medium text-gray-900 :text-white"
        >
          Asunto*
        </label>
        <input
        name="subject"
          type="text"
          id="small-input"
          class="block w-full p-2 text-gray-900 border border-gray-300 rounded-lg bg-gray-50 text-xs focus:ring-green-700 focus:border-green-700"
        />
      </div>
      <div>
        <label
          for="small-input"
          class="block m-2 text-sm font-medium text-gray-900 :text-white"
        >
          Mensaje*
        </label>
        <textarea
        name="message"
          id="small-input"
          class="mb-2 h-20 block w-full p-2 text-gray-900 border border-gray-300 rounded-lg bg-gray-50 text-xs focus:ring-green-700 focus:border-green-700"
        />
      </div>

      <div class="flex items-center">
        <input
          id="link-checkbox"
          type="checkbox"
          value=""
          class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded"
        />
        <label
          for="link-checkbox"
          class="ms-2 mb-2 text-sm font-medium text-gray-900"
        >
          Consiento el uso de mis datos para los fines indicados en la{" "}
          <a
            href="/politica-de-privacidad"
            class="text-blue-600 :text-blue-500 hover:underline"
          >
            política de privacidad*
          </a>
          .
        </label>
      </div>
      <div class="flex justify-center m-2">
        <button type="submit" class="inline-flex items-center justify-center px-5 py-3 text-base font-medium text-center text-white bg-green-700 rounded-lg hover:bg-green-800 focus:ring-4 focus:ring-blue-300">
          Contactar
        </button>
      </div>
    </form>
